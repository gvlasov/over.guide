#!/usr/bin/env bash
set -ex
cd $(git rev-parse --show-toplevel)/backend


# Install code to backend directory on server
tar cfz - config package.json -C target dist | ssh site@smol.guide 'mkdir -p backend; cd backend; rm -rf config dist; cat | tar xz; ls -lah .'
ssh site@smol.guide 'cd backend; npm install'
ssh root@smol.guide 'systemctl restart backend'
echo Backend deployed at $(date "+%Y-%m-%d %H:%M:%S")

